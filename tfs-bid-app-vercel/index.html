<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFS Bid Submission Form</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap)" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #3f51b5; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 9999; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="overlay" class="hidden"><div class="loader"></div></div>
    <div class="container mx-auto max-w-4xl p-4 sm:p-8">
        <div class="text-center mb-8">
            <img src="[https://i.ibb.co/qMWCT1wk/logo-on-white.jpg](https://i.ibb.co/qMWCT1wk/logo-on-white.jpg)" alt="Company Logo" class="mx-auto h-20 w-auto rounded-lg mb-4">
            <h1 class="text-3xl font-bold text-gray-900">Fire Sprinkler Submission</h1>
        </div>
        <form id="submissionForm" class="bg-white p-8 rounded-lg shadow-lg space-y-6">
            <!-- Form fields will be dynamically generated by JavaScript -->
        </form>
    </div>
    <template id="contactTemplate">
        <!-- Contact template goes here -->
    </template>
    <script>
        const GET_DATA_URL = '/api/getData';
        const SUBMIT_FORM_URL = '/api/submitForm';
        
        let companyData = {};
        let jobTitles = [];
        let submitters = [];

        document.addEventListener("DOMContentLoaded", async () => {
            setLoadingState(true);
            try {
                const response = await fetch(GET_DATA_URL);
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || 'Failed to fetch initial data.');
                }
                
                const data = result.data;
                companyData = data.companies || {};
                jobTitles = data.jobTitles || [];
                submitters = data.submitters || [];

                renderForm();
                addContact();
                
            } catch (error) {
                showError(error);
            } finally {
                setLoadingState(false);
            }
        });

        function renderForm() {
            const form = document.getElementById('submissionForm');
            form.innerHTML = `
                <div>
                    <label for="submitter" class="block text-sm font-medium text-gray-700">Submitter</label>
                    <select id="submitter" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></select>
                </div>
                <!-- ... other form fields ... -->
            `;
            populateSubmitters(submitters);
            // ... populate other dropdowns
        }
        
        // --- POPULATION AND DYNAMIC ELEMENT FUNCTIONS ---
        // (addContact, populateContactFields, etc.)

        // --- FORM SUBMISSION ---
        async function handleSubmit(event) {
            event.preventDefault();
            setLoadingState(true);

            try {
                const formData = buildFormData();
                // File handling logic to convert files to base64
                
                const response = await fetch(SUBMIT_FORM_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.message);
                }
                showSuccess(result.message);

            } catch (error) {
                showError(error);
            } finally {
                setLoadingState(false);
            }
        }
        
        function buildFormData() {
            // Logic to gather all data from the form fields
            return { /* ... form data object ... */ };
        }

        // --- UI FEEDBACK FUNCTIONS ---
        function setLoadingState(isLoading) {
            const overlay = document.getElementById('overlay');
            overlay.classList.toggle('hidden', !isLoading);
        }

        function showMessage(msg, type) {
            // Logic to display success/error messages
        }
        
        function showSuccess(message) {
            showMessage(message, 'success');
            document.getElementById('submissionForm').reset();
            // ... reset other dynamic parts of the form
        }

        function showError(error) {
            showMessage('Error: ' + error.message, 'error');
            console.error("An error occurred:", error);
        }
    </script>
</body>
</html
